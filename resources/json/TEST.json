{
	"$schema": "https://vega.github.io/schema/vega-lite/v2.json",	
	"data": { "url": "https://raw.githubusercontent.com/jairoruizsaenz/FPS_ResultadosEncuestas/master/resources/data/_data_.csv","format": {"type": "csv"}},
	"config": {
		"title": {
			"color":"#000000"
		},

		"legend":{}
	},	

	"hconcat": [
	  	{
	  		"vconcat": [
				{					
					"title": {
					    "text": "FILTROS:",
					    "fontSize":15
					  },

					"mark": "bar",
					"width": 190,
					"selection": {"click": {"encodings": ["y"], "type": "multi"}},
					
					"encoding": {
																	
						"x": {
							"axis": {"title": ""},
							"field": "*","type": "quantitative",							
							"aggregate": "count"
						},

						"y": {
							"axis": {"title": "SECCIONAL - G1"},
							"field": "DIVISION", "type": "nominal"							
						},

						"color": {
							"condition": {"selection": "click","value": "steelblue"},
							"value": "lightgray"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "DIVISION","type": "nominal","title": "División"},
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"},
							{"field": "num_total_encuestas","type": "quantitative","title": "# Total de encuestas","format": ",.0f"}
						]					
					},

					"transform": [						
						{
							"window": [{"op": "count","field": "*","as": "num_total_encuestas"}],
							"groupby": ["DIVISION"],							
							"frame": [null, null]
						}						
					]			
			  	},			  	
			  	{					
					
					"mark": "bar",
					"width": 190,
					"selection": {"click": {"encodings": ["y"], "type": "multi"}},
					
					"encoding": {
																	
						"x": {
							"axis": {"title": ""},							
							"field": "*","type": "quantitative",							
							"aggregate": "count"
						},

						"y": {
							"axis": {"title": "TIPO DE SERVICIO - G2"},
							"field": "TIPO_DE_SERVICIO", "type": "nominal"							
						},
						
						"color": {
							"condition": {"selection": "click","value": "steelblue"},
							"value": "lightgray"
						},

						"tooltip": [
							
							{"field": "TIPO_DE_SERVICIO","type": "nominal","title": "División"},
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"},
							{"field": "num_total_encuestas","type": "quantitative","title": "# Total de encuestas","format": ",.0f"}
						]					
					}
					
			  	},			  	
			  	{
					"title": "","mark": "bar","width": 190,
					"selection": {"click": {"encodings": ["y"], "type": "multi"}},
					"encoding": {
						
						"x": {							
							"axis": {"title": "Número de respuestas"},
							"field": "*","type": "quantitative",							
							"aggregate": "count"						
						},

						"y": {
							"axis": {"title": "TRIMESTRE - G3"},
							"field": "TRIMESTRE", "type": "nominal"							
						},
						
						"color": {
							"condition": {"selection": "click","value": "steelblue"},
							"value": "lightgray"
						},

						"tooltip": [
							
							{"field": "TRIMESTRE","type": "nominal","title": "Trimestre"},
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"}
						]					
					}					
			  	},
			  	{
					"title": "","mark": "bar","width": 190,
					"selection": {"click": {"encodings": ["y"], "type": "multi"}},
					"encoding": {
						
						"x": {							
							"axis": {"title": "Número de respuestas"},
							"field": "*","type": "quantitative",							
							"aggregate": "count"						
						},

						"y": {
							"axis": {"title": "AÑO - G4"},
							"field": "ANHO", "type": "nominal"							
						},

						"color": {
							"condition": {"selection": "click","value": "steelblue"},
							"value": "lightgray"
						},
						
						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},						
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"}
						]					
					}					
			  	}
			]
		},
		{
			"vconcat": [
				{
					"title": "¿EL TRATO QUE RECIBIO EN LA ATENCIÓN FUE? - 2017","mark": "bar","width": 190,
					
					"encoding": {
						
						"x": {
							"axis": {"title": "","labelAngle": -70},
							"field": "PREGUNTA_01", "type": "ordinal",							
							"sort": ["EXCELENTE", "BUENO", "REGULAR", "MALO", "NO RESPONDE"]
						},

						"y": {
							"axis": {"title": "PORCENTAJE - G5"},
							"field": "TEMP_03","type": "quantitative"							
						},

						"color": {
							"field": "ANHO", "type": "nominal"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "PREGUNTA_01","type": "nominal","title": "Respuesta"},

							{"field": "*","type": "quantitative","aggregate": "count","title": "# Encuestas","format": ",.0f"},
							
							{"field": "TEMP_02", "type": "quantitative", "title": "#Total Encuestas","format": ",.0f"},							
							{"field": "TEMP_03", "type": "quantitative", "title": "Porcentaje (%)","format": ",.1f"}
							
						]
					},
					  
					"transform": [
						{"filter": {"field": "ANHO", "equal": "2017"}},						
						{"filter": {"field": "TRIMESTRE", "oneOf": ["1", "2"]}},
						{"filter": {"selection": "click"}},
						{
							"window": [{"op": "count","field": "*","as": "TEMP_01"}],
							"groupby": ["PREGUNTA_01"],
							"frame": [null, null]
						},

						{
							"window": [{"op": "count","field": "*","as": "TEMP_02"}],
							"groupby": ["ANHO"],
							"frame": [null, null]
						},						

						{
							"calculate": "(datum.TEMP_01/datum.TEMP_02)*100",
							"as": "TEMP_03"
						}
					]
			  	}
			]
		},
		{
			"vconcat": [
				{
					"title": "¿EL TRATO QUE RECIBIO EN LA ATENCIÓN FUE? - 2017","mark": "bar","width": 190,
					
					"encoding": {
						
						"x": {
							"axis": {"title": "","labelAngle": -70},
							"field": "PREGUNTA_01", "type": "ordinal",							
							"sort": ["EXCELENTE", "BUENO", "REGULAR", "MALO", "NO RESPONDE"]
						},

						"y": {
							"axis": {"title": "PORCENTAJE - G6"},
							"field": "TEMP_03","type": "quantitative"							
						},

						"color": {
							"field": "ANHO", "type": "nominal",
							"legend": {
								"title":"AÑO"
							}
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "PREGUNTA_01","type": "nominal","title": "Respuesta"},

							{"field": "*","type": "quantitative","aggregate": "count","title": "# Encuestas","format": ",.0f"},
							
							{"field": "TEMP_02", "type": "quantitative", "title": "#Total Encuestas","format": ",.0f"},							
							{"field": "TEMP_03", "type": "quantitative", "title": "Porcentaje (%)","format": ",.1f"}					
						]
					},
					  
					"transform": [
						{"filter": {"field": "ANHO", "equal": "2018"}},
						{"filter": {"selection": "click"}},
						{
							"window": [{"op": "count","field": "*","as": "TEMP_01"}],
							"groupby": ["PREGUNTA_01"],
							"frame": [null, null]
						},

						{
							"window": [{"op": "count","field": "*","as": "TEMP_02"}],
							"groupby": ["ANHO"],
							"frame": [null, null]
						},						

						{
							"calculate": "(datum.TEMP_01/datum.TEMP_02)*100",
							"as": "TEMP_03"
						}
					]
			  	}
			]
		}		
	]
}