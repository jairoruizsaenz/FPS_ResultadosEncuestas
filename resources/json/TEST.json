{
	"$schema": "https://vega.github.io/schema/vega-lite/v2.json",
	"title": "TITULO GENERAL DE LA VIZ EN VEGA-LITE",	
	"data": { "url": "https://raw.githubusercontent.com/jairoruizsaenz/FPS_ResultadosEncuestas/master/resources/data/_data_.csv","format": {"type": "csv"}},
	"config": {
		"title": {
			"color":"#f304d3"
		},

		"legend":{			
			"fillColor":"#f304d3"
		}
	},	

	"hconcat": [
	  	{
	  		"vconcat": [
				{					
					"title": {
					    "text": "FILTROS:",					    
					    "fontSize":20
					  },

					"mark": "bar",
					"width": 190,
					"selection": {"click": {"encodings": ["color"], "type": "multi"}},
					
					"encoding": {
																	
						"x": {
							"axis": {"title": ""},
							"field": "*","type": "quantitative",							
							"aggregate": "count"
						},

						"y": {
							"axis": {"title": ""},
							"field": "DIVISION", "type": "nominal"							
						},

						"color": {
							"condition": {"field": "DIVISION","type": "nominal","selection": "click"},
							"value": "lightgray"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "DIVISION","type": "nominal","title": "División"},
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"},
							{"field": "num_total_encuestas","type": "quantitative","title": "# Total de encuestas","format": ",.0f"}
						]					
					},

					"transform": [						
						{
							"window": [{"op": "count","field": "*","as": "num_total_encuestas"}],
							"groupby": ["DIVISION"],							
							"frame": [null, null]
						}						
					]			
			  	},			  	
			  	{
					"title": "","mark": "bar","width": 190,
					"selection": {"click": {"encodings": ["color"], "type": "multi"}},
					"encoding": {
											
						"x": {							
							"axis": {"title": ""},
							"field": "*","type": "quantitative",							
							"aggregate": "count"
						},

						"y": {
							"axis": {"title": ""},
							"field": "ANHO", "type": "nominal"							
						},

						"color": {
							"condition": {"field": "ANHO","selection": "click","type": "nominal"},
							"value": "lightgray"
						},

						"tooltip": [								
								{"field": "ANHO","type": "nominal","title": "Año"},
								{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count","format": ",.0f"}
						]					
					}					
			  	},
			  	{
					"title": "","mark": "bar","width": 190,
					"selection": {"click": {"encodings": ["color"], "type": "multi"}},
					"encoding": {
						
						"x": {							
							"axis": {"title": "Número de respuestas"},
							"field": "*","type": "quantitative",							
							"aggregate": "count"						
						},

						"y": {
							"axis": {"title": ""},
							"field": "ANHO", "type": "nominal"							
						},

						"color": {
							"condition": {"field": "TRIMESTRE","type": "nominal","selection": "click"},
							"value": "lightgray"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "TRIMESTRE","type": "nominal","title": "Trimestre"},
							{"field": "*","type": "quantitative","title": "# Encuestas","aggregate": "count"}
						]					
					}					
			  	}
			]
		},
		{
			"vconcat": [
				{
					"title": "¿EL TRATO QUE RECIBIO EN LA ATENCIÓN FUE? - 2017","mark": "bar","width": 190,
					
					"encoding": {
						
						"x": {
							"axis": {"title": ""},
							"field": "PREGUNTA_01", "type": "ordinal",							
							"sort": ["EXCELENTE", "BUENO", "REGULAR", "MALO", "NO RESPONDE"]
						},

						"y": {
							"axis": {"title": ""},
							"field": "TEMP_03","type": "quantitative"							
						},

						"color": {
							"field": "ANHO", "type": "nominal"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "PREGUNTA_01","type": "nominal","title": "Respuesta"},

							{"field": "*","type": "quantitative","aggregate": "count","title": "# Encuestas","format": ",.0f"},

							{"field": "TEMP_01", "type": "quantitative", "title": "TEMP_01","format": ",.0f"},
							{"field": "TEMP_02", "type": "quantitative", "title": "TEMP_02_#TotalEncuestas_x_año","format": ",.0f"},							
							{"field": "TEMP_03", "type": "quantitative", "title": "TEMP_03_Porcentaje","format": ",.1%"},
							{"field": "jairo", "type": "quantitative", "title": "TEMP_04"}
						]
					},
					  
					"transform": [
						{"filter": {"field": "ANHO", "equal": "2017"}},
						{"filter": {"selection": "click"}},
						{
							"window": [{"op": "count","field": "*","as": "TEMP_01"}],
							"groupby": ["PREGUNTA_01"],
							"frame": [null, null]
						},

						{
							"window": [{"op": "count","field": "*","as": "TEMP_02"}],
							"groupby": ["ANHO"],
							"frame": [null, null]
						},						

						{
							"calculate": "(datum.TEMP_01/datum.TEMP_02)",
							"as": "TEMP_03"
						}
					]
			  	}
			]
		},
		{
			"vconcat": [
				{
					"title": "¿EL TRATO QUE RECIBIO EN LA ATENCIÓN FUE? - 2018","mark": "bar","width": 190,
					
					"encoding": {
						
						"x": {
							"axis": {"title": ""},
							"field": "PREGUNTA_01", "type": "ordinal",							
							"sort": ["EXCELENTE", "BUENO", "REGULAR", "MALO", "NO RESPONDE"]
						},

						"y": {
							"axis": {"title": ""},
							"field": "TEMP_03","type": "quantitative"							
						},

						"color": {
							"field": "ANHO", "type": "nominal"
						},

						"tooltip": [
							{"field": "ANHO","type": "nominal","title": "Año"},
							{"field": "PREGUNTA_01","type": "nominal","title": "Respuesta"},

							{"field": "*","type": "quantitative","aggregate": "count","title": "# Encuestas","format": ",.0f"},

							{"field": "TEMP_01", "type": "quantitative", "title": "TEMP_01","format": ",.0f"},
							{"field": "TEMP_02", "type": "quantitative", "title": "TEMP_02_#TotalEncuestas_x_año","format": ",.0f"},							
							{"field": "TEMP_03", "type": "quantitative", "title": "TEMP_03_Porcentaje","format": ",.1%"},
							{"field": "jairo", "type": "quantitative", "title": "TEMP_04"}
						]
					},
					  
					"transform": [
						{"filter": {"field": "ANHO", "equal": "2018"}},
						{"filter": {"selection": "click"}},
						{
							"window": [{"op": "count","field": "*","as": "TEMP_01"}],
							"groupby": ["PREGUNTA_01"],
							"frame": [null, null]
						},

						{
							"window": [{"op": "count","field": "*","as": "TEMP_02"}],
							"groupby": ["ANHO"],
							"frame": [null, null]
						},						

						{
							"calculate": "(datum.TEMP_01/datum.TEMP_02)",
							"as": "TEMP_03"
						}
					]
			  	}
			]
		}		
	]
}